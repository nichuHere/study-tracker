<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Badge Sprite Position Tester</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      margin-bottom: 10px;
    }
    
    .instructions {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 30px;
      border-left: 4px solid #2196f3;
    }
    
    .sprite-display {
      margin-bottom: 30px;
      padding: 20px;
      background: #fafafa;
      border-radius: 5px;
      position: relative;
    }
    
    .sprite-display img {
      max-width: 100%;
      border: 2px solid #ddd;
      border-radius: 5px;
      image-rendering: pixelated;
      cursor: crosshair;
    }
    
    .sprite-overlay {
      position: absolute;
      border: 2px solid red;
      pointer-events: none;
      background: rgba(255, 0, 0, 0.1);
      z-index: 10;
    }
    
    .zoom-controls {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .image-wrapper {
      overflow: auto;
      max-height: 600px;
      border: 2px solid #ddd;
      border-radius: 5px;
      position: relative;
      background: #fff;
    }
    
    .position-tester {
      margin-bottom: 20px;
    }
    
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
    }
    
    .control-group {
      display: flex;
      flex-direction: column;
    }
    
    .control-group label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
    }
    
    .control-group input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .badge-preview {
      width: 64px;
      height: 64px;
      background-image: url('./src/image/icons-new.png');
      background-repeat: no-repeat;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin: 20px auto;
    }
    
    .code-output {
      background: #263238;
      color: #aed581;
      padding: 20px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      overflow-x: auto;
      margin-top: 20px;
    }
    
    .badge-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .badge-item {
      text-align: center;
      padding: 15px;
      background: #fafafa;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .badge-item .icon {
      width: 64px;
      height: 64px;
      background-image: url('./src/image/icons-new.png');
      background-repeat: no-repeat;
      margin: 0 auto 10px;
      border-radius: 8px;
    }
    
    .badge-item .name {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .badge-item .position {
      font-size: 10px;
      color: #666;
      font-family: monospace;
    }
    
    button {
      background: #2196f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    
    button:hover {
      background: #1976d2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üèÜ Badge Sprite Position Tester</h1>
    <p>Use this tool to find the correct sprite positions for your icons-new.png</p>
    
    <div class="instructions">
      <strong>üìã Instructions:</strong>
      <ol>
        <li><strong>Check the sprite sheet below</strong> - it should show your icons-new.png with badge names visible</li>
        <li><strong>The tool will auto-detect the grid layout</strong> and suggest icon size</li>
        <li><strong>Click "üìç Set Position" button</strong> under each badge in the grid below</li>
        <li><strong>Click on the badge in the sprite image</strong> to set its position (it will snap to grid)</li>
        <li><strong>Repeat for all 8 badges</strong></li>
        <li><strong>Click "Generate Complete Badge Code"</strong> to copy the final positions</li>
        <li><strong>Paste into <code>src/utils/badgeIcons.js</code></strong> replacing the existing positions</li>
      </ol>
      <p style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;">
        üí° <strong>Tip:</strong> Use the zoom buttons if your sprite sheet is small. Look for the badge names in the image to identify each one.
      </p>
    </div>
    
    <div class="sprite-display">
      <h3>üñºÔ∏è Step 1: Your Sprite Sheet (icons-new.png)</h3>
      <div class="zoom-controls">
        <label>Zoom:</label>
        <button onclick="changeZoom(0.5)">50%</button>
        <button onclick="changeZoom(1)">100%</button>
        <button onclick="changeZoom(2)">200%</button>
        <button onclick="changeZoom(4)">400%</button>
        <span style="margin-left: 10px;">Click on the image to select position</span>
      </div>
      <div class="image-wrapper">
        <div style="position: relative; display: inline-block;">
          <img id="fullSprite" src="./src/image/icons-new.png" alt="Full sprite sheet" onclick="handleImageClick(event)">
          <div id="spriteOverlay" class="sprite-overlay" style="display: none;"></div>
        </div>
      </div>
      <p>Image dimensions: <span id="imageDimensions">Loading...</span></p>
      <p>Click coordinates: <span id="clickCoords">Click on image...</span></p>
    </div>
    
    <div class="position-tester">
      <h3>üîß Manual Position Adjuster (Optional)</h3>
      <p style="color: #666; font-size: 14px;">Use this if you need to fine-tune positions manually instead of clicking the sprite.</p>
      
      <div class="controls">
        <div class="control-group">
          <label for="xPos">X Position (pixels)</label>
          <input type="number" id="xPos" value="0" step="1">
        </div>
        
        <div class="control-group">
          <label for="yPos">Y Position (pixels)</label>
          <input type="number" id="yPos" value="0" step="1">
        </div>
        
        <div class="control-group">
          <label for="iconSize">Icon Size (pixels)</label>
          <input type="number" id="iconSize" value="64" step="1">
        </div>
        
        <div class="control-group">
          <label for="spriteScale">Sprite Scale</label>
          <input type="number" id="spriteScale" value="256" step="1">
          <small style="color: #666; margin-top: 5px;">Total sprite width/height</small>
        </div>
      </div>
      
      <div style="text-align: center;">
        <h4>Current Badge Preview</h4>
        <div id="badgePreview" class="badge-preview"></div>
        <button onclick="copyCode()">üìã Copy Code</button>
      </div>
      
      <div class="code-output" id="codeOutput">
        position: { x: 0, y: 0, size: 64 }
      </div>
    </div>
    
    <div>
      <h3>üéØ Step 2: Configure Each Badge Position</h3>
      <p>Click "üìç Set Position" for each badge, then click on that badge in the sprite image above.</p>
      
      <div class="badge-grid" id="badgeGrid">
        <!-- Will be populated by JavaScript -->
      </div>
      
      <div style="margin-top: 30px; padding: 20px; background: #e8f5e9; border-radius: 8px; text-align: center;">
        <h4>üéâ Step 3: Generate Final Code</h4>
        <p style="margin: 10px 0;">Once all badges are positioned correctly, click below to generate and copy the code.</p>
        <button onclick="generateFullCode()" style="font-size: 16px; padding: 12px 24px;">
          üìã Generate Complete Badge Code
        </button>
      </div>
      
      <div class="code-output" id="fullCodeOutput" style="display: none; margin-top: 20px;">
        <div style="color: #aed581; margin-bottom: 10px;">
          ‚úÖ Code copied to clipboard! Paste this into src/utils/badgeIcons.js
        </div>
        <div id="fullCodeText"></div>
      </div>
    </div>
  </div>
  
  <script>
    // Badge definitions
    const badges = [
      { id: 'daily_keep-going', name: 'üí™ Keep Going' },
      { id: 'daily_study-rockstar', name: 'üåü Study Rockstar' },
      { id: 'weekly_weekly-warrior', name: '‚öîÔ∏è Weekly Warrior' },
      { id: 'weekly_study-champion', name: 'üèÖ Study Champion' },
      { id: 'weekly_ultimate-scholar', name: 'üëë Ultimate Scholar' },
      { id: 'achv_star-student', name: '‚≠ê Star Student' },
      { id: 'achv_task-master', name: 'üî• Task Master' },
      { id: 'achv_knowledge-seeker', name: 'üìñ Knowledge Seeker' }
    ];
    
    // Store positions for each badge
    const badgePositions = {};
    
    // Initialize default positions (horizontal row)
    badges.forEach((badge, idx) => {
      badgePositions[badge.id] = { x: idx * 64, y: 0, size: 64 };
    });
    
    let currentZoom = 1;
    let imageNaturalWidth = 0;
    let imageNaturalHeight = 0;
    
    // Get image dimensions
    const fullSprite = document.getElementById('fullSprite');
    fullSprite.onload = function() {
      imageNaturalWidth = this.naturalWidth;
      imageNaturalHeight = this.naturalHeight;
      document.getElementById('imageDimensions').textContent = 
        `${imageNaturalWidth}px √ó ${imageNaturalHeight}px`;
      
      // Auto-detect if it's a grid and suggest positions
      detectGridLayout();
    };
    
    // Detect grid layout
    function detectGridLayout() {
      const suggestions = [];
      
      // Common badge sizes
      const sizes = [32, 48, 64, 96, 128];
      
      sizes.forEach(size => {
        const cols = Math.floor(imageNaturalWidth / size);
        const rows = Math.floor(imageNaturalHeight / size);
        const total = cols * rows;
        
        if (total >= 8) {
          suggestions.push({
            size,
            cols,
            rows,
            total,
            exact: total === 8
          });
        }
      });
      
      if (suggestions.length > 0) {
        const best = suggestions.find(s => s.exact) || suggestions[0];
        console.log('Detected possible grid layouts:', suggestions);
        console.log('Best guess:', best);
        
        // Update iconSize input
        document.getElementById('iconSize').value = best.size;
        document.getElementById('spriteScale').value = imageNaturalWidth;
        
        alert(`üìä Grid detected!\n\nImage size: ${imageNaturalWidth}√ó${imageNaturalHeight}\nSuggested icon size: ${best.size}px\nGrid: ${best.cols} columns √ó ${best.rows} rows (${best.total} total icons)\n\nClick on each badge in the image to set positions.`);
      }
    }
    
    // Change zoom
    function changeZoom(zoom) {
      currentZoom = zoom;
      const img = document.getElementById('fullSprite');
      img.style.width = (imageNaturalWidth * zoom) + 'px';
      img.style.maxWidth = 'none';
    }
    
    // Update preview
    function updatePreview() {
      const x = parseInt(document.getElementById('xPos').value) || 0;
      const y = parseInt(document.getElementById('yPos').value) || 0;
      const size = parseInt(document.getElementById('iconSize').value) || 64;
      const scale = parseInt(document.getElementById('spriteScale').value) || 256;
      
      const preview = document.getElementById('badgePreview');
      preview.style.backgroundSize = `${scale}px ${scale}px`;
      preview.style.backgroundPosition = `-${x}px -${y}px`;
      preview.style.width = `${size}px`;
      preview.style.height = `${size}px`;
      
      document.getElementById('codeOutput').textContent = 
        `position: { x: ${x}, y: ${y}, size: ${size} }`;
    }
    
    // Copy code
    function copyCode() {
      const code = document.getElementById('codeOutput').textContent;
      navigator.clipboard.writeText(code);
      alert('Code copied to clipboard! ‚úÖ');
    }
    
    // Render badge grid
    function renderBadgeGrid() {
      const grid = document.getElementById('badgeGrid');
      grid.innerHTML = badges.map((badge, idx) => {
        const pos = badgePositions[badge.id];
        return `
          <div class="badge-item">
            <div class="icon" id="icon-${idx}" style="
              background-image: url('./src/image/icons-new.png');
              background-size: ${imageNaturalWidth || 256}px ${imageNaturalHeight || 256}px;
              background-position: -${pos.x}px -${pos.y}px;
            "></div>
            <div class="name">${badge.name}</div>
            <div class="position" style="font-size: 10px; margin-top: 5px;">
              <div style="margin-bottom: 3px;">
                <label style="display: inline-block; width: 20px;">X:</label>
                <input type="number" value="${pos.x}" 
                       style="width: 60px; padding: 3px;" 
                       onchange="updateBadgePosition('${badge.id}', 'x', this.value)">
              </div>
              <div>
                <label style="display: inline-block; width: 20px;">Y:</label>
                <input type="number" value="${pos.y}" 
                       style="width: 60px; padding: 3px;"
                       onchange="updateBadgePosition('${badge.id}', 'y', this.value)">
              </div>
            </div>
            <button onclick="setCurrentBadge('${badge.id}')" 
                    style="margin-top: 10px; padding: 5px 10px; font-size: 11px;">
              üìç Set Position
            </button>
          </div>
        `;
      }).join('');
    }
    
    // Set current badge for position adjustment
    let currentBadge = null;
    function setCurrentBadge(badgeId) {
      currentBadge = badgeId;
      const pos = badgePositions[badgeId];
      document.getElementById('xPos').value = pos.x;
      document.getElementById('yPos').value = pos.y;
      updatePreview();
      
      const badge = badges.find(b => b.id === badgeId);
      alert(`üìç Now adjusting: ${badge.name}\n\nClick on the sprite sheet image above to set its position, or use the X/Y controls.`);
    }
    
    // Update badge position
    function updateBadgePosition(badgeId, axis, value) {
      badgePositions[badgeId][axis] = parseInt(value) || 0;
      renderBadgeGrid();
    }
    
    // Auto-set badge position when clicking image (if a badge is selected)
    function handleImageClick(event) {
      const rect = event.target.getBoundingClientRect();
      const scaleX = imageNaturalWidth / rect.width;
      const scaleY = imageNaturalHeight / rect.height;
      
      // Get click position relative to image
      const x = Math.floor((event.clientX - rect.left) * scaleX);
      const y = Math.floor((event.clientY - rect.top) * scaleY);
      
      // Snap to grid based on icon size
      const iconSize = parseInt(document.getElementById('iconSize').value) || 64;
      const snappedX = Math.floor(x / iconSize) * iconSize;
      const snappedY = Math.floor(y / iconSize) * iconSize;
      
      // Update input fields
      document.getElementById('xPos').value = snappedX;
      document.getElementById('yPos').value = snappedY;
      
      // If a badge is selected, update its position
      if (currentBadge) {
        badgePositions[currentBadge].x = snappedX;
        badgePositions[currentBadge].y = snappedY;
        renderBadgeGrid();
        
        const badge = badges.find(b => b.id === currentBadge);
        document.getElementById('clickCoords').textContent = 
          `Set ${badge.name} to X: ${snappedX}px, Y: ${snappedY}px`;
      } else {
        document.getElementById('clickCoords').textContent = 
          `X: ${snappedX}px, Y: ${snappedY}px (Select a badge below first)`;
      }
      
      // Update overlay
      const overlay = document.getElementById('spriteOverlay');
      overlay.style.display = 'block';
      overlay.style.left = (snappedX / scaleX) + 'px';
      overlay.style.top = (snappedY / scaleY) + 'px';
      overlay.style.width = (iconSize / scaleX) + 'px';
      overlay.style.height = (iconSize / scaleY) + 'px';
      
      updatePreview();
    }
    
    // Generate full code
    function generateFullCode() {
      const code = badges.map(badge => {
        const pos = badgePositions[badge.id];
        return `  {
    id: '${badge.id}',
    // ... other properties
    icon: {
      fallback: iconsSprite,
      position: { x: ${pos.x}, y: ${pos.y}, size: ${pos.size} }
    }
  }`;
      }).join(',\n\n');
      
      const output = document.getElementById('fullCodeOutput');
      const codeText = document.getElementById('fullCodeText');
      codeText.textContent = code;
      output.style.display = 'block';
      
      // Scroll to output
      output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      
      navigator.clipboard.writeText(code);
    }
    
    // Event listeners
    document.getElementById('xPos').addEventListener('input', updatePreview);
    document.getElementById('yPos').addEventListener('input', updatePreview);
    document.getElementById('iconSize').addEventListener('input', updatePreview);
    document.getElementById('spriteScale').addEventListener('input', updatePreview);
    
    // Initialize
    updatePreview();
    renderBadgeGrid();
  </script>
</body>
</html>
